# color =================================================== {{{
# Solarized (256色) カラースキーム
# https://github.com/seebi/tmux-colors-solarized

# ステータスバー全体の配色
set-option -g status-style bg=colour235,fg=colour136,default

# 非アクティブウィンドウのタイトル色
set-window-option -g window-status-style fg=colour244,bg=default

# アクティブウィンドウのタイトル色
set-window-option -g window-status-current-style fg=colour166,bg=default

# ペイン境界線
set-option -g pane-border-style fg=colour235
set-option -g pane-active-border-style fg=colour240

# tmux のメッセージ表示色
set-option -g message-style bg=colour235,fg=colour166

# ペイン番号表示色
set-option -g display-panes-active-colour colour33   # 青
set-option -g display-panes-colour colour166          # オレンジ

# 時計表示色
set-window-option -g clock-mode-colour colour64       # 緑
# }}}

# copy mode =============================================== {{{
# copy-mode を vim キーバインドで操作する
# v: 選択開始 / y, Enter: コピー確定
bind-key -T copy-mode-vi v     send-keys -X begin-selection
bind-key -T copy-mode-vi y     send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi Enter send-keys -X copy-selection-and-cancel

# --- tmux と OS クリップボードの連携方針 ---
# コピー:
#   copy-mode-vi 中の y / Enter で、選択範囲を OS クリップボードへ送る
# ペースト:
#   prefix + P で、OS クリップボードの内容を tmux に貼り付ける
#
# 注意:
#   prefix + p はペイン移動に使っているため、ペーストには割り当てない
#   tmux 標準の ']'（tmux バッファ貼り付け）は温存する

# macOS (pbcopy / pbpaste が存在する場合のみ有効化)
if-shell 'type pbcopy'  "bind-key -T copy-mode-vi y     send-keys -X copy-pipe-and-cancel 'pbcopy'"
if-shell 'type pbcopy'  "bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel 'pbcopy'"
if-shell 'type pbpaste' "bind-key P run 'tmux set-buffer -- \"$(pbpaste)\"; tmux paste-buffer'"

# WSL (win32yank.exe が存在する場合のみ有効化)
# https://github.com/equalsraf/win32yank
if-shell 'type win32yank.exe' "bind-key -T copy-mode-vi y     send-keys -X copy-pipe-and-cancel 'win32yank.exe -i'"
if-shell 'type win32yank.exe' "bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel 'win32yank.exe -i'"
if-shell 'type win32yank.exe' "bind-key P  run 'tmux set-buffer -- \"$(win32yank.exe -o)\"; tmux paste-buffer'"

# 単語区切り（copy-mode の w / b 移動に影響）
set-option -g word-separators " -_@'\",./:;"
# }}}

# pane ==================================================== {{{
# ペイン番号表示時間（ms）
set-option -g display-panes-time 10000

# ペイン番号を 1 始まりにする
set-window-option -g pane-base-index 1

# 現在のペインを指定番号のウィンドウに join
bind-key j command-prompt -p index "join-pane -t ':%%'"

# ペイン境界に情報を表示
# ペイン番号 / 実行中コマンド / カレントディレクトリ
set-window-option -g pane-border-status bottom
set-window-option -g pane-border-format "#P #{pane_current_command} #{pane_current_path}"
# }}}

# prefix key ============================================== {{{
# prefix キーを C-t に変更（C-b は使わない）
set-option -g prefix C-t
unbind-key C-b
bind-key C-t send-prefix
# }}}

# log ===================================================== {{{
# ペインの標準出力をログに保存
# H: ログ開始 / h: ログ終了
bind-key H pipe-pane 'mkdir -p $HOME/.tmux; cat >> $HOME/.tmux/tmux-#I-#W-`date "+%Y%m%d-%H%M%S"`.log' \; display-message 'Started logging to $HOME/.tmux/tmux-#I-#W.log'
bind-key h pipe-pane \; display-message 'Ended logging to $HOME/.tmux/tmux-#I-#W.log'
# }}}

# shell =================================================== {{{
# tmux 起動時のデフォルトシェル（必要なら有効化）
#set-option -g default-shell ~/local/bin/zsh
# }}}

# status bar ============================================== {{{
# ステータスバーを 10 秒ごとに更新
# 秒単位の正確さは不要なので、CPU/Wakeup を抑える
set-option -g status-interval 10

set-option -g status-left-length  60
set-option -g status-right-length 20
set-option -g status-justify centre

# 左: セッション/ウィンドウ/ペイン/タイトル
set-option -g status-left  "#S/#I:#W/#P:#T"

# 右: 日付と時刻
set-option -g status-right "%b %d / %R"
# }}}

# terminal (256 colors) =================================== {{{
# tmux 用に最適化された terminfo を使う
# screen-256color よりも、色・キーの互換性が高い
set-option -g default-terminal "tmux-256color"

# --- alternate screen について ---
# 多くの TUI アプリ (less / vim / tig など) は
# alternate screen 前提で動作するため、無効化しない
#
# 無効化すると、スクロール崩れや画面破壊が起きやすい
#
# set-window-option -g alternate-screen off
# }}}

# vi ====================================================== {{{
# copy-mode などで vi キーバインドを使う
set-window-option -g mode-keys vi
# }}}

# window ================================================== {{{
# ウィンドウ入れ替え
bind-key -r < swap-window -t -1
bind-key -r > swap-window -t +1

# ウィンドウ番号を 1 始まりにする
set-option -g base-index 1

# アプリによるウィンドウ名変更を禁止
set-window-option -g allow-rename off
set-window-option -g automatic-rename off
# }}}

# Esc 系キー入力の安定性向上
# 0 にすると vim/neovim でキー取りこぼしが起きることがある
set-option -g escape-time 10

# vim: ft=tmux foldmethod=marker
